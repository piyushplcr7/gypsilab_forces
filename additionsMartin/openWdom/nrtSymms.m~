%% Resolution of Symm's integral equation
clear all
close all;

addpathSimpleCurve; % Development
addpathUtils;

c = openline(-1,1);
m = meshCurve(c,51,'varChange',{@cos,[-pi,0]});
edges = bnd(m);
X1 = edges.vtx(1,:);
X2 = edges.vtx(2,:);
% Weight definition :
[X,Y,Z] = FunR3.XYZ;
omega1 = sqrt((X1(1) - X).^2 + (X1(2) - Y).^2 + (X1(3) - Z).^2);
omega2 = sqrt((X2(1) - X).^2 + (X2(2) - Y).^2 + (X2(3) - Z).^2);
omega = sqrt(1 - X^2);
singVtx = [X1;X2]; % Singularities of 1/omega
singPow = [-1/2;-1/2]; % Power law of the singularities
sing = {singVtx,singPow};

% Integration domain
gss = 5;
tic;
Gamma = Wdom(m,gss,1/omega,sing);
toc;
check = integral(Gamma,0*X +1);
pi - check
% Finite element:
Vh = fem(m,'P0');
rhs1 = integral(Gamma,Vh,X+1);


k = 0;
GXY = @(X,Y)femGreenKernel(X,Y,'[log(r)]',k);
Sh = -1/(2*pi)*(...
    integral(Gamma,Gamma,Vh,GXY,Vh)  ...
    + regularize(Gamma,Gamma,Vh,'[log(r)]',Vh));


u = Sh\rhs;
c = m.ctr;
if strcmp(Vh.typ,'P0')
    plot(c(:,1),u);
else
    plot(m.vtx(:,1),u)
end
